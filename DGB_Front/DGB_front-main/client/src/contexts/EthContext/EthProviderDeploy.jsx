/* eslint-disable */
import React, { useReducer, useCallback, useEffect } from "react";
import Web3 from "web3";
import EthContext from "./EthContext";
import { reducer, actions, initialState } from "./state";
// 백 데이터 전송용
import { serverIP, dgbID } from "../../axioses/config.jsx";
import axios, { formToJSON } from "axios";

function EthProviderDeploy({ children }) {
  const [state, dispatch] = useReducer(reducer, initialState);

  // esg 컨트랙트 초기화
  const esgInit = useCallback(
    async esgArtifact => {
      if (esgArtifact) {
        const web3 = new Web3(Web3.givenProvider || "ws://localhost:8545");
        const accounts = await web3.eth.requestAccounts();
        const networkID = await web3.eth.net.getId();
        const { abi } = esgArtifact;
        let address, contract;

        try {
          address = esgArtifact.networks[networkID].address;
          contract = new web3.eth.Contract(abi, address);
          await esgDeployBind(contract);
        } catch (err) {
          console.error(err);
        }
        dispatch({
          type: actions.init,
          data: { esgArtifact, web3, accounts, networkID, contract }
        });
      }
    }, []);

  // esg test 용 함수 - esg 소유주 불러오기
  const printOwner = async (instance) => {
    let esgInstance;
    esgInstance = instance;

    const deployButton = document.getElementById("deploy");
    deployButton.addEventListener("click", function () {
      esgInstance.methods.owner().call().then(function (result) {
        console.log(result);
      }).catch(function (err) {
        console.log(err.message);
      })
    })
  };

  // esg test 용 함수 - esg 소유주 변경하기
  const transferOwner = async (instance) => {
    let esgInstance, fromAcc, txid;
    esgInstance = instance;
    const newAddr = "0x5894d987cFc846830b693378D3676899ED7015D5";
    fromAcc = window.web3.currentProvider.selectedAddress.toString();

    const deployButton = document.getElementById("deploy");
      deployButton.addEventListener("click", function () {
   
      esgInstance.methods.transferOwnership(newAddr).send({ from: fromAcc }).then(async function (receipt) {
        txid = receipt.transactionHash;
        console.log(txid);
      }).catch(function (err) {
        console.log(err.message);
      })
    })
  };

  // esg 배포 - deploy 보고서 NFT 발행 - 'cdetail' 기업 페이지
  // "보고서 신청" 버튼 연결
  // deploy 후 DB에 저장
  const esgDeployBind = async (instance) => {
    try {
      // 변수 선언
      let esgInstance, fromAcc, esgID;
      esgInstance = instance;
      fromAcc = window.ethereum.selectedAddress.toString();

      // 버튼 연결
      const deployButton = document.getElementById("deploy");
      deployButton.addEventListener("click", function () {
        // 바이트코드 넣기
        esgInstance.options.data = '0x60806040523480156200001157600080fd5b506040518060400160405280600381526020017f44474200000000000000000000000000000000000000000000000000000000008152506040518060400160405280600381526020017f646f6e000000000000000000000000000000000000000000000000000000000081525081600090805190602001906200009692919062000176565b508060019080519060200190620000af92919062000176565b50505033600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a36200028a565b828054620001849062000255565b90600052602060002090601f016020900481019282620001a85760008555620001f4565b82601f10620001c357805160ff1916838001178555620001f4565b82800160010185558215620001f4579182015b82811115620001f3578251825591602001919060010190620001d6565b5b50905062000203919062000207565b5090565b5b808211156200022257600081600090555060010162000208565b5090565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200026e57607f821691505b60208210810362000284576200028362000226565b5b50919050565b61342b806200029a6000396000f3fe608060405234801561001057600080fd5b50600436106101165760003560e01c8063715018a6116100a2578063b88d4fde11610071578063b88d4fde146102cb578063c87b56dd146102e7578063d85d3d2714610317578063e985e9c514610347578063f2fde38b1461037757610116565b8063715018a6146102695780638da5cb5b1461027357806395d89b4114610291578063a22cb465146102af57610116565b806323b872dd116100e957806323b872dd146101b557806342842e0e146101d157806342966c68146101ed5780636352211e1461020957806370a082311461023957610116565b806301ffc9a71461011b57806306fdde031461014b578063081812fc14610169578063095ea7b314610199575b600080fd5b61013560048036038101906101309190611fe2565b610393565b604051610142919061202a565b60405180910390f35b610153610475565b60405161016091906120de565b60405180910390f35b610183600480360381019061017e9190612136565b610507565b60405161019091906121a4565b60405180910390f35b6101b360048036038101906101ae91906121eb565b61058c565b005b6101cf60048036038101906101ca919061222b565b6106a3565b005b6101eb60048036038101906101e6919061222b565b610703565b005b61020760048036038101906102029190612136565b610723565b005b610223600480360381019061021e9190612136565b61077f565b60405161023091906121a4565b60405180910390f35b610253600480360381019061024e919061227e565b610830565b60405161026091906122ba565b60405180910390f35b6102716108e7565b005b61027b610a38565b60405161028891906121a4565b60405180910390f35b610299610a62565b6040516102a691906120de565b60405180910390f35b6102c960048036038101906102c49190612301565b610af4565b005b6102e560048036038101906102e09190612476565b610b0a565b005b61030160048036038101906102fc9190612136565b610b6c565b60405161030e91906120de565b60405180910390f35b610331600480360381019061032c919061259a565b610cbd565b60405161033e91906122ba565b60405180910390f35b610361600480360381019061035c91906125e3565b610dea565b60405161036e919061202a565b60405180910390f35b610391600480360381019061038c919061227e565b610e7e565b005b60007f80ac58cd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061045e57507f5b5e139f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061046e575061046d8261103d565b5b9050919050565b60606000805461048490612652565b80601f01602080910402602001604051908101604052809291908181526020018280546104b090612652565b80156104fd5780601f106104d2576101008083540402835291602001916104fd565b820191906000526020600020905b8154815290600101906020018083116104e057829003601f168201915b5050505050905090565b6000610512826110a7565b610551576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610548906126f5565b60405180910390fd5b6004600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b60006105978261077f565b90508073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610607576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105fe90612787565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff16610626611113565b73ffffffffffffffffffffffffffffffffffffffff16148061065557506106548161064f611113565b610dea565b5b610694576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161068b90612819565b60405180910390fd5b61069e838361111b565b505050565b6106b46106ae611113565b826111d4565b6106f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106ea906128ab565b60405180910390fd5b6106fe8383836112b2565b505050565b61071e83838360405180602001604052806000815250610b0a565b505050565b61073461072e611113565b826111d4565b610773576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161076a9061293d565b60405180910390fd5b61077c81611518565b50565b6000806002600084815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610827576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161081e906129cf565b60405180910390fd5b80915050919050565b60008073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036108a0576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161089790612a61565b60405180910390fd5b600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b3373ffffffffffffffffffffffffffffffffffffffff16600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610977576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161096e90612acd565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a36000600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b606060018054610a7190612652565b80601f0160208091040260200160405190810160405280929190818152602001828054610a9d90612652565b8015610aea5780601f10610abf57610100808354040283529160200191610aea565b820191906000526020600020905b815481529060010190602001808311610acd57829003601f168201915b5050505050905090565b610b06610aff611113565b838361156b565b5050565b610b1b610b15611113565b836111d4565b610b5a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b51906128ab565b60405180910390fd5b610b66848484846116d7565b50505050565b6060610b77826110a7565b610bb6576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610bad90612b5f565b60405180910390fd5b6000600660008481526020019081526020016000208054610bd690612652565b80601f0160208091040260200160405190810160405280929190818152602001828054610c0290612652565b8015610c4f5780601f10610c2457610100808354040283529160200191610c4f565b820191906000526020600020905b815481529060010190602001808311610c3257829003601f168201915b505050505090506000610c60611733565b90506000815103610c75578192505050610cb8565b600082511115610caa578082604051602001610c92929190612bbb565b60405160208183030381529060405292505050610cb8565b610cb38461174a565b925050505b919050565b60003373ffffffffffffffffffffffffffffffffffffffff16600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610d4f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d4690612acd565b60405180910390fd5b610d5960086117f1565b6000610d656008611807565b9050610d713382611815565b610d7b81846119ee565b610da8600960009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166001610af4565b7f07554a03a62c3cb37a877bd179226e5626e1158ca4f7d1e2306683ed4a41e4dd8184604051610dd9929190612bdf565b60405180910390a180915050919050565b6000600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b3373ffffffffffffffffffffffffffffffffffffffff16600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610f0e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f0590612acd565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610f7d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f7490612c81565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff16600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a380600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b60008073ffffffffffffffffffffffffffffffffffffffff166002600084815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614159050919050565b600033905090565b816004600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff1661118e8361077f565b73ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b60006111df826110a7565b61121e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161121590612d13565b60405180910390fd5b60006112298361077f565b90508073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16148061126b575061126a8185610dea565b5b806112a957508373ffffffffffffffffffffffffffffffffffffffff1661129184610507565b73ffffffffffffffffffffffffffffffffffffffff16145b91505092915050565b8273ffffffffffffffffffffffffffffffffffffffff166112d28261077f565b73ffffffffffffffffffffffffffffffffffffffff1614611328576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161131f90612da5565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611397576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161138e90612e37565b60405180910390fd5b6113a2838383611a62565b6113ad60008261111b565b6001600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546113fd9190612e86565b925050819055506001600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546114549190612eba565b92505081905550816002600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4611513838383611a67565b505050565b61152181611a6c565b600060066000838152602001908152602001600020805461154190612652565b905014611568576006600082815260200190815260200160002060006115679190611e93565b5b50565b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036115d9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016115d090612f5c565b60405180910390fd5b80600560008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31836040516116ca919061202a565b60405180910390a3505050565b6116e28484846112b2565b6116ee84848484611b89565b61172d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161172490612fee565b60405180910390fd5b50505050565b606060405180602001604052806000815250905090565b6060611755826110a7565b611794576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161178b90613080565b60405180910390fd5b600061179e611733565b905060008151116117be57604051806020016040528060008152506117e9565b806117c884611d10565b6040516020016117d9929190612bbb565b6040516020818303038152906040525b915050919050565b6001816000016000828254019250508190555050565b600081600001549050919050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611884576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161187b906130ec565b60405180910390fd5b61188d816110a7565b156118cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118c490613158565b60405180910390fd5b6118d960008383611a62565b6001600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546119299190612eba565b92505081905550816002600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a46119ea60008383611a67565b5050565b6119f7826110a7565b611a36576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a2d906131ea565b60405180910390fd5b80600660008481526020019081526020016000209080519060200190611a5d929190611ed3565b505050565b505050565b505050565b6000611a778261077f565b9050611a8581600084611a62565b611a9060008361111b565b6001600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254611ae09190612e86565b925050819055506002600083815260200190815260200160002060006101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905581600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4611b8581600084611a67565b5050565b6000611baa8473ffffffffffffffffffffffffffffffffffffffff16611e70565b15611d03578373ffffffffffffffffffffffffffffffffffffffff1663150b7a02611bd3611113565b8786866040518563ffffffff1660e01b8152600401611bf5949392919061325f565b6020604051808303816000875af1925050508015611c3157506040513d601f19601f82011682018060405250810190611c2e91906132c0565b60015b611cb3573d8060008114611c61576040519150601f19603f3d011682016040523d82523d6000602084013e611c66565b606091505b506000815103611cab576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611ca290612fee565b60405180910390fd5b805181602001fd5b63150b7a0260e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614915050611d08565b600190505b949350505050565b606060008203611d57576040518060400160405280600181526020017f30000000000000000000000000000000000000000000000000000000000000008152509050611e6b565b600082905060005b60008214611d89578080611d72906132ed565b915050600a82611d829190613364565b9150611d5f565b60008167ffffffffffffffff811115611da557611da461234b565b5b6040519080825280601f01601f191660200182016040528015611dd75781602001600182028036833780820191505090505b5090505b60008514611e6457600182611df09190612e86565b9150600a85611dff9190613395565b6030611e0b9190612eba565b60f81b818381518110611e2157611e206133c6565b5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600a85611e5d9190613364565b9450611ddb565b8093505050505b919050565b6000808273ffffffffffffffffffffffffffffffffffffffff163b119050919050565b508054611e9f90612652565b6000825580601f10611eb15750611ed0565b601f016020900490600052602060002090810190611ecf9190611f59565b5b50565b828054611edf90612652565b90600052602060002090601f016020900481019282611f015760008555611f48565b82601f10611f1a57805160ff1916838001178555611f48565b82800160010185558215611f48579182015b82811115611f47578251825591602001919060010190611f2c565b5b509050611f559190611f59565b5090565b5b80821115611f72576000816000905550600101611f5a565b5090565b6000604051905090565b600080fd5b600080fd5b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b611fbf81611f8a565b8114611fca57600080fd5b50565b600081359050611fdc81611fb6565b92915050565b600060208284031215611ff857611ff7611f80565b5b600061200684828501611fcd565b91505092915050565b60008115159050919050565b6120248161200f565b82525050565b600060208201905061203f600083018461201b565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561207f578082015181840152602081019050612064565b8381111561208e576000848401525b50505050565b6000601f19601f8301169050919050565b60006120b082612045565b6120ba8185612050565b93506120ca818560208601612061565b6120d381612094565b840191505092915050565b600060208201905081810360008301526120f881846120a5565b905092915050565b6000819050919050565b61211381612100565b811461211e57600080fd5b50565b6000813590506121308161210a565b92915050565b60006020828403121561214c5761214b611f80565b5b600061215a84828501612121565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061218e82612163565b9050919050565b61219e81612183565b82525050565b60006020820190506121b96000830184612195565b92915050565b6121c881612183565b81146121d357600080fd5b50565b6000813590506121e5816121bf565b92915050565b6000806040838503121561220257612201611f80565b5b6000612210858286016121d6565b925050602061222185828601612121565b9150509250929050565b60008060006060848603121561224457612243611f80565b5b6000612252868287016121d6565b9350506020612263868287016121d6565b925050604061227486828701612121565b9150509250925092565b60006020828403121561229457612293611f80565b5b60006122a2848285016121d6565b91505092915050565b6122b481612100565b82525050565b60006020820190506122cf60008301846122ab565b92915050565b6122de8161200f565b81146122e957600080fd5b50565b6000813590506122fb816122d5565b92915050565b6000806040838503121561231857612317611f80565b5b6000612326858286016121d6565b9250506020612337858286016122ec565b9150509250929050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61238382612094565b810181811067ffffffffffffffff821117156123a2576123a161234b565b5b80604052505050565b60006123b5611f76565b90506123c1828261237a565b919050565b600067ffffffffffffffff8211156123e1576123e061234b565b5b6123ea82612094565b9050602081019050919050565b82818337600083830152505050565b6000612419612414846123c6565b6123ab565b90508281526020810184848401111561243557612434612346565b5b6124408482856123f7565b509392505050565b600082601f83011261245d5761245c612341565b5b813561246d848260208601612406565b91505092915050565b600080600080608085870312156124905761248f611f80565b5b600061249e878288016121d6565b94505060206124af878288016121d6565b93505060406124c087828801612121565b925050606085013567ffffffffffffffff8111156124e1576124e0611f85565b5b6124ed87828801612448565b91505092959194509250565b600067ffffffffffffffff8211156125145761251361234b565b5b61251d82612094565b9050602081019050919050565b600061253d612538846124f9565b6123ab565b90508281526020810184848401111561255957612558612346565b5b6125648482856123f7565b509392505050565b600082601f83011261258157612580612341565b5b813561259184826020860161252a565b91505092915050565b6000602082840312156125b0576125af611f80565b5b600082013567ffffffffffffffff8111156125ce576125cd611f85565b5b6125da8482850161256c565b91505092915050565b600080604083850312156125fa576125f9611f80565b5b6000612608858286016121d6565b9250506020612619858286016121d6565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061266a57607f821691505b60208210810361267d5761267c612623565b5b50919050565b7f4552433732313a20617070726f76656420717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b60006126df602c83612050565b91506126ea82612683565b604082019050919050565b6000602082019050818103600083015261270e816126d2565b9050919050565b7f4552433732313a20617070726f76616c20746f2063757272656e74206f776e6560008201527f7200000000000000000000000000000000000000000000000000000000000000602082015250565b6000612771602183612050565b915061277c82612715565b604082019050919050565b600060208201905081810360008301526127a081612764565b9050919050565b7f4552433732313a20617070726f76652063616c6c6572206973206e6f74206f7760008201527f6e6572206e6f7220617070726f76656420666f7220616c6c0000000000000000602082015250565b6000612803603883612050565b915061280e826127a7565b604082019050919050565b60006020820190508181036000830152612832816127f6565b9050919050565b7f4552433732313a207472616e736665722063616c6c6572206973206e6f74206f60008201527f776e6572206e6f7220617070726f766564000000000000000000000000000000602082015250565b6000612895603183612050565b91506128a082612839565b604082019050919050565b600060208201905081810360008301526128c481612888565b9050919050565b7f4552433732314275726e61626c653a2063616c6c6572206973206e6f74206f7760008201527f6e6572206e6f7220617070726f76656400000000000000000000000000000000602082015250565b6000612927603083612050565b9150612932826128cb565b604082019050919050565b600060208201905081810360008301526129568161291a565b9050919050565b7f4552433732313a206f776e657220717565727920666f72206e6f6e657869737460008201527f656e7420746f6b656e0000000000000000000000000000000000000000000000602082015250565b60006129b9602983612050565b91506129c48261295d565b604082019050919050565b600060208201905081810360008301526129e8816129ac565b9050919050565b7f4552433732313a2061646472657373207a65726f206973206e6f74206120766160008201527f6c6964206f776e65720000000000000000000000000000000000000000000000602082015250565b6000612a4b602983612050565b9150612a56826129ef565b604082019050919050565b60006020820190508181036000830152612a7a81612a3e565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b6000612ab7602083612050565b9150612ac282612a81565b602082019050919050565b60006020820190508181036000830152612ae681612aaa565b9050919050565b7f45524337323155524953746f726167653a2055524920717565727920666f722060008201527f6e6f6e6578697374656e7420746f6b656e000000000000000000000000000000602082015250565b6000612b49603183612050565b9150612b5482612aed565b604082019050919050565b60006020820190508181036000830152612b7881612b3c565b9050919050565b600081905092915050565b6000612b9582612045565b612b9f8185612b7f565b9350612baf818560208601612061565b80840191505092915050565b6000612bc78285612b8a565b9150612bd38284612b8a565b91508190509392505050565b6000604082019050612bf460008301856122ab565b8181036020830152612c0681846120a5565b90509392505050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b6000612c6b602683612050565b9150612c7682612c0f565b604082019050919050565b60006020820190508181036000830152612c9a81612c5e565b9050919050565b7f4552433732313a206f70657261746f7220717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b6000612cfd602c83612050565b9150612d0882612ca1565b604082019050919050565b60006020820190508181036000830152612d2c81612cf0565b9050919050565b7f4552433732313a207472616e736665722066726f6d20696e636f72726563742060008201527f6f776e6572000000000000000000000000000000000000000000000000000000602082015250565b6000612d8f602583612050565b9150612d9a82612d33565b604082019050919050565b60006020820190508181036000830152612dbe81612d82565b9050919050565b7f4552433732313a207472616e7366657220746f20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b6000612e21602483612050565b9150612e2c82612dc5565b604082019050919050565b60006020820190508181036000830152612e5081612e14565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000612e9182612100565b9150612e9c83612100565b925082821015612eaf57612eae612e57565b5b828203905092915050565b6000612ec582612100565b9150612ed083612100565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115612f0557612f04612e57565b5b828201905092915050565b7f4552433732313a20617070726f766520746f2063616c6c657200000000000000600082015250565b6000612f46601983612050565b9150612f5182612f10565b602082019050919050565b60006020820190508181036000830152612f7581612f39565b9050919050565b7f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560008201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b6000612fd8603283612050565b9150612fe382612f7c565b604082019050919050565b6000602082019050818103600083015261300781612fcb565b9050919050565b7f4552433732314d657461646174613a2055524920717565727920666f72206e6f60008201527f6e6578697374656e7420746f6b656e0000000000000000000000000000000000602082015250565b600061306a602f83612050565b91506130758261300e565b604082019050919050565b600060208201905081810360008301526130998161305d565b9050919050565b7f4552433732313a206d696e7420746f20746865207a65726f2061646472657373600082015250565b60006130d6602083612050565b91506130e1826130a0565b602082019050919050565b60006020820190508181036000830152613105816130c9565b9050919050565b7f4552433732313a20746f6b656e20616c7265616479206d696e74656400000000600082015250565b6000613142601c83612050565b915061314d8261310c565b602082019050919050565b6000602082019050818103600083015261317181613135565b9050919050565b7f45524337323155524953746f726167653a2055524920736574206f66206e6f6e60008201527f6578697374656e7420746f6b656e000000000000000000000000000000000000602082015250565b60006131d4602e83612050565b91506131df82613178565b604082019050919050565b60006020820190508181036000830152613203816131c7565b9050919050565b600081519050919050565b600082825260208201905092915050565b60006132318261320a565b61323b8185613215565b935061324b818560208601612061565b61325481612094565b840191505092915050565b60006080820190506132746000830187612195565b6132816020830186612195565b61328e60408301856122ab565b81810360608301526132a08184613226565b905095945050505050565b6000815190506132ba81611fb6565b92915050565b6000602082840312156132d6576132d5611f80565b5b60006132e4848285016132ab565b91505092915050565b60006132f882612100565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361332a57613329612e57565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b600061336f82612100565b915061337a83612100565b92508261338a57613389613335565b5b828204905092915050565b60006133a082612100565b91506133ab83612100565b9250826133bb576133ba613335565b5b828206905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fdfea2646970667358221220d104a69a043e8bf5f10710c80b65ab39f22763179f7ebd514b92111aa8f4eae564736f6c634300080d0033';
        // 배포하기
        esgInstance.deploy({
          arguments: []
        })
          .send({
            from: fromAcc
          })
          .then(async function (newContractInstance) {
            // 새로운 컨트랙트 주소
            esgID = newContractInstance.options.address;
            await dgbBackDeploy(esgID);
          });

      }).catch(function (err) {
        console.log(err.message);
      });
    } catch (err) {
      if (err.name === 'TypeError') { }
      else { console.error(err) };
    }
  };

  // Back 서버로 데이터 넘기기 - deploy 후 컨트랙트 ID 넘기기
  const dgbBackDeploy = async (_esgAddr) => {
    try {
      // 변수 선언
      const companyId = document.getElementById("companyId").textContent;
      const esgAddr = _esgAddr;
      let request;

      let data = {
        "companyid": companyId,
        "contractaddr": esgAddr,
      };

      request = axios.post(serverIP + "/companies/contractaddrs", JSON.stringify(data), {
        headers: {
          'Content-Type': 'application/json'
        }
      });

      axios.all([request])
        .then(axios.spread((response) => {
          console.log(response.data);
        }))
        .catch(error => {
          console.error(error);
        });

      alert("배포가 성공적으로 완료되었습니다.");
      document.location.href = `/cdetail/${companyId}`

    } catch (err) {
      console.error(err);
    }
  };


  useEffect(() => {
    const tryInit = async () => {
      try {
        const esgArtifact = require("../../contracts/ESG.json");
        esgInit(esgArtifact);
      } catch (err) {
        console.error(err);
      }
    };

    tryInit();
  }, [esgInit]);

  useEffect(() => {
    const events = ["chainChanged", "accountsChanged"];
    const handleChange = () => {
      esgInit(state.esgArtifact);
    };

    events.forEach(e => window.ethereum.on(e, handleChange));
    return () => {
      events.forEach(e => window.ethereum.removeListener(e, handleChange));
    };
  }, [esgInit, state.esgArtifact]);


  return (
    <EthContext.Provider value={{
      state,
      dispatch
    }}>
      {children}
    </EthContext.Provider>
  );
}

export default EthProviderDeploy;
